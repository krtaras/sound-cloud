<!DOCTYPE html>
<html>
<head>
	<title></title>
	<link rel="stylesheet" type="text/css" href="style.css">
	<script type="text/javascript" src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
	<script src="https://connect.soundcloud.com/sdk.js"></script>
	<script>
		function getCookie(cname) {
		    var name = cname + "=";
		    var ca = document.cookie.split(';');
		    for(var i=0; i<ca.length; i++) {
		        var c = ca[i];
		        while (c.charAt(0)==' ') c = c.substring(1);
		        if (c.indexOf(name) != -1) return c.substring(name.length,c.length);
		    }
		    return "";
		}
		
		function connect(port) {
			document.body.style.backgroundColor='red';
			SC.initialize({
				client_id: 'c0e833fecbe9557b9ba8e676b4786b3a',
				redirect_uri: 'http://krtaras.github.io/sound-cloud/callback.html',
				access_token: getCookie("soundCloudToken"),
	            		scope: 'non-expiring'
			});
	
			if (!SC.isConnected()) {
				SC.connect(function() {
					document.cookie="soundCloudToken=" + SC.accessToken();
					window.postMessage(SC.accessToken(), "*");
					port.postMessage({access_token : SC.accessToken()}); 
					close();
				});
			} else {
				port.postMessage({access_token : SC.accessToken()}); 
				close();
			}
			document.body.style.backgroundColor='blue';
		}
	</script>
</head>
<body>
</body>
</html>
